"0",""
"0","consolidation_cols <- function(tbl) {"
"0","  "
"0","  tbl %>% "
"0","    select(admin1pcode, admin2pcode, admin3pcode, admin4pcode, "
"0","           admin5pcode, camp_name, "
"0","           activity, beneficiaries, "
"0","           month, project_status, cluster, "
"0","           delivery_modality, "
"0","           transfer_value, total_usd)"
"0","}"
"0",""
"0","# Finally! This works!!! Hahahahhahahaha "
"0",""
"0","com <- rbind("
"0","  "
"0","  prot %>% "
"0","    filter(unit == ""# people"") %>% "
"0","    mutate(beneficiaries = total_achieved_as_per_unit, "
"0","           month = str_to_lower(str_sub(month, start = 6L, end = 8L)), "
"0","           project_status = ""Completed"", "
"0","           cluster = ""Protection"", "
"0","           transfer_value = NA_integer_, "
"0","           total_usd = NA_integer_) %>% "
"0","    rename(camp_name = camps) %>% "
"0","    consolidation_cols(),"
"0","  "
"0","  nut %>% "
"0","    mutate(month = str_to_lower(str_sub(implementing_month, start = 1L, end = 3L)),"
"0","           admin5pcode = NA_character_, "
"0","           # Extracts all text before the first instance of punctuation"
"0","           delivery_modality = str_extract(service_delivery_modality, ""^[^[:punct:]]+""), "
"0","           cluster = ""Nutrition"", "
"0","           # I'm not sure this is the correct calculation"
"0","           total_usd = frequency * transfer_value * beneficiaries) %>% "
"0","    rename(project_status = status) %>% "
"0","    consolidation_cols(),"
"0","  "
"0","  wash %>%"
"0","    pivot_longer(cols = c(rehab_repair_water_station, "
"0","                          o_m, "
"0","                          construction_water_station, "
"0","                          network_rehab, "
"0","                          construction_water_network, "
"0","                          chlorination, "
"0","                          wq_testing, "
"0","                          fuel_consumption, "
"0","                          water_safety_plans, "
"0","                          water_trucking, "
"0","                          cash_assistance_water_trucking, "
"0","                          pvt_boreholes, "
"0","                          cash_assistance_private_boreholes, "
"0","                          tanks_pwd_ben, "
"0","                          hh_water_treatment, "
"0","                          hh_water_treatement_cash_assistance, "
"0","                          sew_rehab_repair, "
"0","                          sew_support, "
"0","                          sew_construction, "
"0","                          beneficiaries_toilets, "
"0","                          pw_d_beneficiaries_toilet, "
"0","                          beneficiaries_cash_toilets, "
"0","                          bath_new, "
"0","                          cash_bath,"
"0","                          des_beneficiaries, "
"0","                          swm_support_benf, "
"0","                          hp_ben, "
"0","                          hp_pwd_ben, "
"0","                          hk_ben, "
"0","                          cash_hk, "
"0","                          pwd_beneficiaries, "
"0","                          wash_nfi_ben, "
"0","                          incinerator_health_facilities, "
"0","                          cholera_safe_water, "
"0","                          chlorin_cholera, "
"0","                          cholera_sew, "
"0","                          cholera_kit, "
"0","                          cholera_hp_rcce_iec, "
"0","                          cholera_wash_in_health), "
"0","                 names_to = ""activity"", values_to = ""beneficiaries"") %>% "
"0","    mutate(delivery_modality = NA_character_,"
"0","           cluster = ""WASH"", "
"0","           month = str_to_lower(month)) %>% "
"0","    # If you don't do this, you get repeats "
"0","    group_by(activity, admin4pcode) %>% "
"0","    slice(which.max(beneficiaries)) %>% "
"0","    ungroup() %>% "
"0","    filter(!is.na(beneficiaries)) %>% "
"0","    mutate(transfer_value = NA_integer_) %>% "
"0","    consolidation_cols(), "
"0","  "
"0","  snfi %>% "
"0","    mutate(month = str_to_lower(str_sub(reporting_month, start = 1L, end = 3L)),"
"0","           admin5pcode = NA_character_,  "
"0","           camp_name = NA_character_,"
"0","           cluster = ""SNFI"") %>% "
"0","    consolidation_cols(),"
"0","  "
"0","  cccm %>% "
"0","    pivot_longer(cols = (jan:dec), names_to = ""month"", values_to = ""beneficiaries"") %>% "
"0","    filter(admin3pcode %in% nw_pcode3) %>% "
"0","    mutate(admin5pcode = NA_character_,  "
"0","           camp_name = NA_character_, "
"0","           project_status = ""Completed"", "
"0","           delivery_modality = NA_character_, "
"0","           transfer_value = NA_integer_,"
"0","           total_usd = NA_integer_,"
"0","           cluster = str_to_upper(cluster)) %>% "
"0","    filter(!is.na(beneficiaries)) %>% "
"0","    consolidation_cols(), "
"0","  "
"0","  fsl %>% "
"0","    mutate(month = str_to_lower(str_sub(reporting_month, start = 1L, end = 3L)), "
"0","           # Not sure if I should just make it all ""Ongoing"" instead"
"0","           project_status = ""Completed"", "
"0","           cluster = ""FSL"") %>%"
"0","    consolidation_cols(), "
"0","  "
"0","  fsl_tracker %>% "
"0","    mutate(month = month(distribution_date, label = TRUE), "
"0","           month = str_to_lower(month), "
"0","           cluster = ""FSL"", "
"0","           admin5pcode = NA_character_) %>% "
"0","    consolidation_cols(),"
"0","  "
"0","  cash %>% "
"0","    mutate(month = month(distribution_date, label = TRUE), "
"0","           month = str_to_lower(month), "
"0","           activity = ""multipurpose cash"", "
"0","           cluster = ""Cash"", "
"0","           delivery_modality = ""cash"") %>% "
"0","    consolidation_cols(),  "
"0","  "
"0","  erl %>% "
"0","    mutate(month = str_sub(implementing_month, start = 5L, end = 7L), "
"0","           month = str_to_lower(month),"
"0","           cluster = ""ERL"", "
"0","           admin5pcode = NA_character_) %>% "
"0","    rename(camp_name = other_place_name, "
"0","           activity = sector_activity, "
"0","           project_status = status) %>% "
"0","    consolidation_cols(), "
"0","  "
"0","  edu %>% "
"0","    mutate(month = str_to_lower(str_sub(reporting_month, start = 4L, end = 6L)), "
"0","           cluster = ""Education"", "
"0","           admin5pcode = NA_character_, "
"0","           transfer_value = NA_integer_, "
"0","           total_usd = NA_integer_) %>%"
"0","    select(-beneficiaries) %>% "
"0","    rename(beneficiaries = ben_frequencies, "
"0","           project_status = status, "
"0","           delivery_modality = activity_modality) %>% "
"0","    consolidation_cols()"
"0",") %>% "
"0","  "
"0","  mutate(project_status = recode(project_status, "
"0","                                 ""In progress"" = ""Ongoing"", "
"0","                                 ""ongoing"" = ""Ongoing"")) %>% "
"0","  mutate(delivery_modality = "
"0","           recode(delivery_modality, "
"0","                  ""cash"" = ""Cash"", "
"0","                  ""In-kind"" = ""In-Kind"", "
"0","                  ""Services"" = ""Service delivery/support""), "
"0","         # Assuming that NAs in project status are ongoing activities "
"0","         # Choosing `ongoing` over `completed` as the default as it is the most common"
"0","         project_status = ifelse(is.na(project_status), "
"0","                                 ""Ongoing"", "
"0","                                 project_status)) %>% "
"0","  mutate(site = case_when(!is.na(admin5pcode) ~ admin5pcode, "
"0","                          !is.na(camp_name) ~ camp_name, "
"0","                          TRUE ~ admin4pcode)) %>% "
"0","  mutate(activity = "
"0","           case_when(str_detect(activity, ""Activity 2.01 Financial"") ~ ""Grants, seed funds, loans"","
"0","                     str_detect(activity, ""Activity 2.03 Create"") ~ ""Create work opportunities"","
"0","                     str_detect(activity, ""Activity 2.07 Unemployment"") ~ "
"0","                       ""Unemployed youth capacity building"","
"0","                     str_detect(activity, ""Activity 2.09 Provide"") ~ ""Market-based assistance"", "
"0","                     activity == ""multipurpose cash"" ~ ""Multipurpose cash"", "
"0","                     activity == ""1.1.1.2: Provision of seasonal and supplementary NFIs"" ~ "
"0","                       ""Seasonal and supplementary NFIs"", "
"0","                     activity == ""2.1.1.1: Rehabilitation of damaged/ unfinished housing"" ~ "
"0","                       ""Rehabilitation of damaged/unfinished housing"", "
"0","                     TRUE ~ activity"
"0","                     )) %>% "
"0","  # I think it's cash that's the problem"
"0","  filter(!is.na(beneficiaries))"
"0",""
"0",""
"0","com %>% write_csv(""./data/com.csv"")"
