"0","admin4 <- rbind( 
  wash %>%
    mutate(month = str_to_lower(month)) %>% 
    filter(project_status == ""Completed"") %>% 
    group_by(month, 
             health_facility_name, 
             school_name, 
             collective_shelter_name, 
             admin5pcode, 
             admin4pcode) %>%
    slice(which.max(so2)) %>% 
    group_by(admin4pcode, month) %>% 
    summarise(beneficiaries = sum(so2, na.rm = TRUE)) %>% 
    ungroup() %>% 
    mutate(cluster = ""WASH""),
  
  cash %>% 
    group_by(month = month(distribution_date, label = TRUE)) %>% 
    filter(!is.na(month)) %>% 
    mutate(month = str_to_lower(month)) %>% 
    filter(project_status == ""Completed"" & previously_assisted == ""No"") %>%
    mutate(month = ifelse(month == ""nov"", ""apr"", month)) %>% 
    group_by(admin4pcode, month) %>% 
    summarise(beneficiaries = sum(beneficiaries, na.rm = TRUE), 
              .groups = ""drop"") %>% 
    ungroup() %>% 
    mutate(cluster = ""Cash""),
  
  cccm %>% 
    filter(activity == ""CCCM"") %>% 
    pivot_longer(cols = (jan:dec), names_to = ""month"", values_to = ""beneficiaries"") %>% 
    group_by(admin4pcode, month) %>%
    slice(which.max(beneficiaries)) %>% 
    ungroup() %>% 
    select(admin4pcode, beneficiaries, month) %>% 
    mutate(cluster = ""CCCM""),
  
  erl %>%  
    mutate(month = str_sub(implementing_month, start = 5L, end = 7L)) %>% 
    filter(report_this_to_any_other_sector == ""No"" & previously_assisted == ""No"") %>% 
    group_by(admin4pcode, month) %>% 
    summarise(beneficiaries = sum(beneficiaries, na.rm = TRUE), 
              .groups = ""drop"") %>% 
    ungroup() %>% 
    mutate(cluster = ""ERL""),
  
  fsl_com %>% 
    filter(activity == ""Food Baskets"" & project_status != ""Planned"") %>% 
    group_by(admin4pcode, month) %>% 
    slice(which.max(beneficiaries)) %>% 
    ungroup() %>% 
    select(admin4pcode, beneficiaries, month) %>% 
    mutate(cluster = ""Food""),
  
  fsl_com %>% 
    filter(activity %in% c(""Agricultural inputs"",
                           ""Animal treatment/vaccination"",
                           ""Income-generating activities (IGAs)"", 
                           ""Infrastructure rehabilitation"",
                           ""Livestock asset restoration"") &
             project_status != ""Planned"") %>% 
    group_by(admin4pcode, month) %>% 
    slice(which.max(beneficiaries)) %>% 
    ungroup() %>% 
    select(admin4pcode, beneficiaries, month) %>% 
    mutate(cluster = ""Livelihoods""),
  
  nut %>% 
    mutate(month = str_to_lower(str_sub(implementing_month, start = 1L, end = 3L))) %>% 
    group_by(admin4pcode, month) %>% 
    slice(which.max(beneficiaries)) %>% 
    ungroup() %>% 
    select(admin4pcode, beneficiaries, month) %>% 
    mutate(cluster = ""Nutrition""),
  
  edu %>% 
    mutate(month = str_to_lower(str_sub(reporting_month, start = 4L, end = 6L))) %>% 
    group_by(admin4pcode, month) %>% 
    slice(which.max(beneficiaries)) %>% 
    ungroup() %>% 
    select(admin4pcode, beneficiaries, month) %>% 
    mutate(cluster = ""Education""),
  
  prot %>% 
    mutate(month = str_to_lower(str_sub(month, start = 6L, end = 8L))) %>%
    filter(ao_r == ""Child Protection"" & 
             analysis_unit == ""# people"" & 
             hrp_indicator %out% c(""1.3.1"", ""None"") & 
             !is.na(hrp_indicator)) %>% 
    group_by(admin4pcode, month) %>% 
    summarise(beneficiaries = sum(total_reached, na.rm = TRUE), 
              .groups = ""drop"") %>% 
    mutate(cluster = ""Child Protection""),
  
  prot %>% 
    mutate(month = str_to_lower(str_sub(month, start = 6L, end = 8L))) %>%
    filter(code_activity == ""GBV100"" & 
             !is.na(hrp_indicator) & 
             hrp_indicator %out% c(""None"") & 
             analysis_unit == ""# people"") %>%
    group_by(admin4pcode, month) %>% 
    summarise(beneficiaries = sum(total_reached, na.rm = TRUE), 
              .groups = ""drop"") %>%
    mutate(cluster = ""GBV""),
  
  prot %>% 
    mutate(month = str_to_lower(str_sub(month, start = 6L, end = 8L))) %>% 
    filter(ao_r == ""Humanitarian Mine Action"" &
             analysis_unit == ""# people"") %>% 
    group_by(admin4pcode, month) %>% 
    summarise(beneficiaries = sum(total_reached, na.rm = TRUE), 
              .groups = ""drop"") %>% 
    mutate(cluster = ""Mine Action""),
  
  prot %>% 
    mutate(month = str_to_lower(str_sub(month, start = 6L, end = 8L))) %>%
    filter(ao_r == ""Protection"" &
             analysis_unit == ""# people"") %>% 
    group_by(admin4pcode, month) %>% 
    summarise(beneficiaries = sum(total_reached, na.rm = TRUE), 
              .groups = ""drop"") %>% 
    mutate(cluster = ""General Protection""),
  
  snfi %>% 
    filter(sub_cluster == ""nfi"" & activity == ""1.1.1.1: Provision of core NFIs"" & 
                    new_beneficiaries == ""Yes"") %>%  
    mutate(month = str_to_lower(str_sub(reporting_month, start = 1L, end = 3L))) %>% 
    group_by(admin4pcode, month) %>% 
    summarise(beneficiaries = sum(beneficiaries, na.rm = TRUE), 
              .groups = ""drop"") %>% 
    mutate(cluster = ""NFI""),
  
  snfi %>% 
    filter(sub_cluster == ""shelter"" & new_beneficiaries == ""Yes"") %>%  
    mutate(month = str_to_lower(str_sub(reporting_month, start = 1L, end = 3L))) %>% 
    group_by(admin4pcode, month) %>% 
    summarise(beneficiaries = sum(beneficiaries, na.rm = TRUE), 
              .groups = ""drop"") %>% 
    mutate(cluster = ""Shelter"")
  
)
"
"2","`summarise()` has grouped output by 'admin4pcode'. You can override using the `.groups` argument."
