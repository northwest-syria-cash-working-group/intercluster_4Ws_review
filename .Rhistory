com %>%
filter(!is.na(admin4pcode) &
activity != "ISIMM" &
project_status %in% c("Completed", "Ongoing")) %>%
group_by(admin4pcode) %>%
slice(which.max(beneficiaries)) %>%
ungroup() %>%
right_join(pop %>%
mutate(size_group = case_when(total_pop < 1000 ~ "Small, under 1,000",
total_pop >= 1000 & total_pop < 10000 ~ "Medium, 1,000 - 9,999",
total_pop >= 10000 & total_pop < 100000 ~ "Large, 10,000 - 99,999",
total_pop >= 100000 ~ "Very large, 100,000 and above")) %>%
select(total_pop, size_group, admin4pcode),
by = "admin4pcode") %>%
replace_na(list(beneficiaries = 0)) %>%
mutate(pc = beneficiaries / total_pop) %>%
ggplot(aes(x = pc)) +
geom_histogram() +
geom_vline(aes(xintercept = pc),
colour = "blue", lty = 2, alpha = .7,
data = size_means) +
geom_text(aes(label = percent(pc, accuracy = .1),
x = Inf, y = Inf,), hjust = 1, vjust = 1,
data = size_means) +
scale_x_log10(labels = percent) +
scale_y_continuous() +
facet_grid(~ factor(size_group,
levels = c(
"Small, under 1,000",
"Medium, 1,000 - 9,999",
"Large, 10,000 - 99,999",
"Very large, 100,000 and above")),
scales = "free_y") +
labs("Percentage of population reached, by size of community",
x = "",
y = "Number of communities") +
theme(axis.text.x = element_text(angle = 60, hjust = .5, vjust = .5))
com %>%
filter(!is.na(admin4pcode) &
activity != "ISIMM" &
project_status %in% c("Completed", "Ongoing")) %>%
group_by(admin4pcode) %>%
slice(which.max(beneficiaries)) %>%
ungroup() %>%
right_join(pop %>%
mutate(size_group = case_when(total_pop < 1000 ~ "Small, under 1,000",
total_pop >= 1000 & total_pop < 10000 ~ "Medium, 1,000 - 9,999",
total_pop >= 10000 & total_pop < 100000 ~ "Large, 10,000 - 99,999",
total_pop >= 100000 ~ "Very large, 100,000 and above")) %>%
select(total_pop, size_group, admin4pcode),
by = "admin4pcode") %>%
replace_na(list(beneficiaries = 0)) %>%
mutate(pc = beneficiaries / total_pop) %>%
ggplot(aes(x = pc)) +
geom_histogram() +
geom_vline(aes(xintercept = pc),
colour = "blue", lty = 2, alpha = .7,
data = size_means) +
geom_text(aes(label = percent(pc, accuracy = .1),
x = Inf, y = Inf,), hjust = 1, vjust = 1,
data = size_means) +
scale_x_log10(labels = percent) +
scale_y_continuous() +
facet_grid(~ factor(size_group,
levels = c(
"Small, under 1,000",
"Medium, 1,000 - 9,999",
"Large, 10,000 - 99,999",
"Very large, 100,000 and above")),
scales = "free_y") +
labs("Percentage of population reached, by size of community",
x = "",
y = "Number of communities") +
theme(axis.text.x = element_text(angle = 50, hjust = .5, vjust = .5))
com %>%
filter(!is.na(admin4pcode) &
activity != "ISIMM" &
project_status %in% c("Completed", "Ongoing")) %>%
group_by(admin4pcode) %>%
slice(which.max(beneficiaries)) %>%
ungroup() %>%
right_join(pop %>%
mutate(size_group = case_when(total_pop < 1000 ~ "Small, under 1,000",
total_pop >= 1000 & total_pop < 10000 ~ "Medium, 1,000 - 9,999",
total_pop >= 10000 & total_pop < 100000 ~ "Large, 10,000 - 99,999",
total_pop >= 100000 ~ "Very large, 100,000 and above")) %>%
select(total_pop, size_group, admin4pcode),
by = "admin4pcode") %>%
replace_na(list(beneficiaries = 0)) %>%
mutate(pc = beneficiaries / total_pop) %>%
ggplot(aes(x = pc)) +
geom_histogram() +
geom_vline(aes(xintercept = pc),
colour = "blue", lty = 2, alpha = .7,
data = size_means) +
geom_text(aes(label = percent(pc, accuracy = .1),
x = Inf, y = Inf,), hjust = 1, vjust = 1,
data = size_means) +
scale_x_log10(labels = percent) +
scale_y_continuous() +
facet_grid(~ factor(size_group,
levels = c(
"Small, under 1,000",
"Medium, 1,000 - 9,999",
"Large, 10,000 - 99,999",
"Very large, 100,000 and above")),
scales = "free_y") +
labs("Percentage of population reached, by size of community",
x = "Percentage of population covered",
y = "Number of communities") +
theme(axis.text.x = element_text(angle = 50, hjust = .5, vjust = .5))
com %>%
filter(!is.na(admin4pcode) &
activity != "ISIMM" &
project_status %in% c("Completed", "Ongoing")) %>%
group_by(admin4pcode) %>%
slice(which.max(beneficiaries)) %>%
ungroup() %>%
left_join(pop %>% select(admin4pcode, total_pop),
by = "admin4pcode") %>%
mutate(pc = beneficiaries / total_pop) %>%
ggplot(aes(x = pc)) +
geom_histogram() +
scale_x_log10(labels = percent) +
labs(x = "Percent of population covered",
title = "Percentage covered in communities reached by response")
com %>%
filter(project_status %in% c("Completed", "Ongoing")) %>%
filter(delivery_modality %in% c("Cash", "Voucher")) %>%
group_by(activity, cluster) %>%
summarise(beneficiary_frequencies = sum(beneficiaries, na.rm = TRUE)) %>%
ungroup() %>%
arrange(desc(beneficiary_frequencies)) %>%
flextable() %>%
theme_zebra() %>%
set_caption("Breakdown of CVA by activity") %>%
set_table_properties(layout = "autofit", width = .8)
com %>%
group_by(cluster, admin4pcode) %>%
summarise(count = n()) %>%
pairwise_cor(cluster, admin4pcode, value = count,
method = c("spearman"), upper = FALSE) %>%
arrange(desc(correlation))
com %>%
filter(!is.na(admin4pcode) & !is.na(activity)) %>%
pairwise_count(activity, admin4pcode, sort = TRUE)
com %>%
group_by(cluster, admin4pcode) %>%
summarise(count = n()) %>%
pairwise_cor(cluster, admin4pcode, value = count,
method = c("spearman"), upper = FALSE) %>%
arrange(desc(correlation)) %>%
left_join(
com %>% group_by(cluster, admin4),
by = c("Item1", "Item2")
)
com %>%
group_by(cluster, admin4pcode) %>%
summarise(count = n()) %>%
pairwise_cor(cluster, admin4pcode, value = count,
method = c("spearman"), upper = FALSE) %>%
arrange(desc(correlation)) %>%
left_join(
com %>% group_by(cluster, admin4pcode),
by = c("Item1", "Item2")
)
com %>% group_by(cluster, admin4pcode),
com %>%
group_by(cluster, admin4pcode) %>%
summarise(count = n()) %>%
pairwise_cor(cluster, admin4pcode, value = count,
method = c("spearman"), upper = FALSE) %>%
arrange(desc(correlation)) %>%
left_join(
com %>%
pairwise_count(cluster, admin4pcode),
by = c("Item1", "Item2")
)
com %>%
pairwise_count(cluster, admin4pcode)
com %>%
group_by(cluster, admin4pcode) %>%
summarise(count = n()) %>%
pairwise_cor(cluster, admin4pcode, value = count,
method = c("spearman"), upper = FALSE) %>%
arrange(desc(correlation)) %>%
left_join(
com %>%
pairwise_count(cluster, admin4pcode),
by = c("item1", "item2")
)
com %>%
group_by(cluster, admin4pcode) %>%
summarise(count = n()) %>%
pairwise_cor(cluster, admin4pcode, value = count,
method = c("spearman"), upper = FALSE) %>%
arrange(desc(correlation)) %>%
left_join(
com %>%
pairwise_count(cluster, admin4pcode),
by = c("item1", "item2")
) %>%
rename(cluster1 = item1,
cluster2 = item2) %>%
mutate(correlation = round(correlation, digits = 3))
com %>%
filter(activity != "ISIMM") %>%
group_by(cluster, admin4pcode) %>%
summarise(count = n()) %>%
pairwise_cor(cluster, admin4pcode, value = count,
method = c("spearman"), upper = FALSE) %>%
arrange(desc(correlation)) %>%
left_join(
com %>%
filter(activity != "ISIMM") %>%
pairwise_count(cluster, admin4pcode),
by = c("item1", "item2")
) %>%
rename(cluster1 = item1,
cluster2 = item2) %>%
mutate(correlation = round(correlation, digits = 3))
com %>%
filter(activity != "ISIMM") %>%
group_by(cluster, admin4pcode) %>%
summarise(count = n()) %>%
pairwise_cor(cluster, admin4pcode, value = count,
method = c("spearman"), upper = FALSE) %>%
arrange(desc(correlation)) %>%
left_join(
com %>%
filter(activity != "ISIMM") %>%
pairwise_count(cluster, admin4pcode),
by = c("item1", "item2")
) %>%
rename(cluster1 = item1,
cluster2 = item2,
count = n) %>%
mutate(correlation = round(correlation, digits = 3)) %>%
flextable() %>%
theme_zebra() %>%
set_caption("Cluster pairs, correlations and count of occurences")
com %>%
filter(activity != "ISIMM") %>%
group_by(cluster, admin4pcode) %>%
summarise(count = n()) %>%
pairwise_cor(cluster, admin4pcode, value = count,
method = c("spearman"), upper = FALSE) %>%
arrange(desc(correlation)) %>%
left_join(
com %>%
filter(activity != "ISIMM") %>%
pairwise_count(cluster, admin4pcode),
by = c("item1", "item2")
) %>%
rename(cluster1 = item1,
cluster2 = item2,
count = n) %>%
mutate(correlation = round(correlation, digits = 3)) %>%
flextable() %>%
theme_zebra() %>%
set_caption("Cluster pairs, correlations and count of occurences") %>%
set_table_properties(layout = "autofit", width = .7)
com %>%
filter(activity != "ISIMM") %>%
group_by(cluster, admin4pcode) %>%
summarise(count = n()) %>%
pairwise_cor(cluster, admin4pcode, value = count,
method = c("spearman"), upper = FALSE) %>%
arrange(desc(correlation)) %>%
left_join(
com %>%
filter(activity != "ISIMM") %>%
pairwise_count(cluster, admin4pcode),
by = c("item1", "item2")
) %>%
rename(cluster1 = item1,
cluster2 = item2,
count = n) %>%
mutate(correlation = round(correlation, digits = 3)) %>%
DT()
com %>%
filter(activity != "ISIMM") %>%
group_by(cluster, admin4pcode) %>%
summarise(count = n()) %>%
pairwise_cor(cluster, admin4pcode, value = count,
method = c("spearman"), upper = FALSE) %>%
arrange(desc(correlation)) %>%
left_join(
com %>%
filter(activity != "ISIMM") %>%
pairwise_count(cluster, admin4pcode),
by = c("item1", "item2")
) %>%
rename(cluster1 = item1,
cluster2 = item2,
count = n) %>%
mutate(correlation = round(correlation, digits = 3)) %>%
datatable()
com %>%
filter(activity != "ISIMM") %>%
group_by(cluster, admin4pcode) %>%
summarise(count = n()) %>%
pairwise_cor(cluster, admin4pcode, value = count,
method = c("spearman"), upper = FALSE) %>%
arrange(desc(correlation)) %>%
left_join(
com %>%
filter(activity != "ISIMM") %>%
pairwise_count(cluster, admin4pcode),
by = c("item1", "item2")
) %>%
rename(cluster1 = item1,
cluster2 = item2,
count = n) %>%
mutate(correlation = round(correlation, digits = 3)) %>%
datatable(caption = htmltools::tags$caption(style = 'caption-side: top;
text-align: center; font-size:120% ;',
"Cluster pairs, correlations and co-occurences"))
com %>%
filter(activity != "ISIMM") %>%
group_by(cluster, admin4pcode) %>%
summarise(count = n()) %>%
pairwise_cor(cluster, admin4pcode, value = count,
method = c("spearman"), upper = FALSE) %>%
arrange(desc(correlation)) %>%
left_join(
com %>%
filter(activity != "ISIMM") %>%
pairwise_count(cluster, admin4pcode),
by = c("item1", "item2")
) %>%
rename(cluster1 = item1,
cluster2 = item2,
count = n) %>%
mutate(correlation = round(correlation, digits = 3)) %>%
datatable(options = list(pageLength = 10, scrollX = TRUE),
filter = list(position = "top", clear = FALSE),
caption = htmltools::tags$caption(style = 'caption-side: top;
text-align: center; font-size:120% ;',
"Cluster pairs, correlations and co-occurences"))
com %>%
filter(activity != "ISIMM") %>%
group_by(cluster, admin4pcode) %>%
summarise(count = n()) %>%
pairwise_cor(cluster, admin4pcode, value = count,
method = c("spearman"), upper = FALSE) %>%
arrange(desc(correlation)) %>%
left_join(
com %>%
filter(activity != "ISIMM") %>%
pairwise_count(cluster, admin4pcode),
by = c("item1", "item2")
) %>%
rename(cluster1 = item1,
cluster2 = item2,
count = n) %>%
mutate(correlation = round(correlation, digits = 3)) %>%
datatable(options = list(pageLength = 10, scrollY = FALSE),
filter = list(position = "top", clear = FALSE),
caption = htmltools::tags$caption(style = 'caption-side: top;
text-align: center; font-size:120% ;',
"Cluster pairs, correlations and co-occurences"))
com %>%
filter(!is.na(admin4pcode) & activity != "ISIMM") %>%
group_by(admin4pcode) %>%
summarise(sectors = n_distinct(cluster)) %>%
ggplot(aes(x = sectors)) +
geom_histogram(bins = 9) +
scale_x_continuous(breaks = seq(1, 9, by = 1)) +
geom_text(stat = "count", aes(label=..count..), vjust= - 0.5) +
expand_limits(y = 260) +
labs(x = "Number of sectors",
y = "Number of communities",
title = "245 communities only have one cluster present")
com %>%
filter(!is.na(admin4pcode) & activity != "ISIMM") %>%
group_by(admin4pcode) %>%
summarise(sectors = n_distinct(cluster)) %>%
ggplot(aes(x = sectors)) +
geom_histogram(bins = 9) +
scale_x_continuous(breaks = seq(1, 9, by = 1)) +
geom_text(stat = "count", aes(label = after_stat(count)), vjust= - 0.5) +
expand_limits(y = 260) +
labs(x = "Number of sectors",
y = "Number of communities",
title = "245 communities only have one cluster present")
com %>%
filter(!is.na(admin4pcode) ) %>%
group_by(admin4pcode, cluster) %>%
summarise(beneficiaries = sum(beneficiaries, na.rm = TRUE)) %>%
ungroup() %>%
pivot_wider(names_from = cluster, values_from = beneficiaries) %>%
mutate(clusters = rowSums(!is.na(.[,-1]))) %>%
{mean(.$clusters, na.rm = TRUE)}
com %>%
filter(!is.na(admin4pcode) ) %>%
group_by(admin4pcode, cluster) %>%
summarise(beneficiaries = sum(beneficiaries, na.rm = TRUE)) %>%
ungroup() %>%
pivot_wider(names_from = cluster, values_from = beneficiaries) %>%
mutate(clusters = rowSums(!is.na(.[,-1]))) %>%
filter(admin4pcode %in% reached_100) %>%
{mean(.$clusters, na.rm = TRUE)}
com %>%
filter(!is.na(admin4pcode) ) %>%
group_by(admin4pcode, cluster) %>%
summarise(beneficiaries = sum(beneficiaries, na.rm = TRUE)) %>%
ungroup() %>%
pivot_wider(names_from = cluster, values_from = beneficiaries) %>%
mutate(clusters = rowSums(!is.na(.[,-1]))) %>%
ummarise(cash = sum(!is.na(Cash)),
education = sum(!is.na(Education)),
fsl = sum(!is.na(FSL)),
nut = sum(!is.na(Nutrition)),
prot = sum(!is.na(Protection)),
snfi = sum(!is.na(SNFI)),
wash = sum(!is.na(WASH)),
erl = sum(!is.na(ERL)),
cccm = sum(!is.na(CCCM)),
edu = sum(!is.na(Education)))
com %>%
filter(!is.na(admin4pcode) ) %>%
group_by(admin4pcode, cluster) %>%
summarise(beneficiaries = sum(beneficiaries, na.rm = TRUE)) %>%
ungroup() %>%
pivot_wider(names_from = cluster, values_from = beneficiaries) %>%
mutate(clusters = rowSums(!is.na(.[,-1]))) %>%
summarise(cash = sum(!is.na(Cash)),
education = sum(!is.na(Education)),
fsl = sum(!is.na(FSL)),
nut = sum(!is.na(Nutrition)),
prot = sum(!is.na(Protection)),
snfi = sum(!is.na(SNFI)),
wash = sum(!is.na(WASH)),
erl = sum(!is.na(ERL)),
cccm = sum(!is.na(CCCM)),
edu = sum(!is.na(Education)))
com %>%
filter(!is.na(admin4pcode) & activity != "ISIMM") %>%
group_by(admin4pcode, cluster) %>%
summarise(beneficiaries = sum(beneficiaries, na.rm = TRUE)) %>%
ungroup() %>%
pivot_wider(names_from = cluster, values_from = beneficiaries) %>%
mutate(clusters = rowSums(!is.na(.[,-1])))
com %>%
filter(!is.na(admin4pcode) & activity != "ISIMM") %>%
group_by(admin4pcode, cluster) %>%
summarise(beneficiaries = sum(beneficiaries, na.rm = TRUE)) %>%
ungroup() %>%
pivot_wider(names_from = cluster, values_from = beneficiaries) %>%
mutate(clusters = rowSums(!is.na(.[,-1]))) %>%
filter(clusters == 1 & is.na(CCCM))
# Clusters operating alone
com %>%
filter(!is.na(admin4pcode) & activity != "ISIMM") %>%
group_by(admin4pcode, cluster) %>%
summarise(beneficiaries = sum(beneficiaries, na.rm = TRUE)) %>%
ungroup() %>%
pivot_wider(names_from = cluster, values_from = beneficiaries) %>%
mutate(clusters = rowSums(!is.na(.[,-1]))) %>%
filter(clusters == 1 & is.na(CCCM)) %>%
summarise(cash = sum(!is.na(Cash)),
education = sum(!is.na(Education)),
fsl = sum(!is.na(FSL)),
nut = sum(!is.na(Nutrition)),
prot = sum(!is.na(Protection)),
snfi = sum(!is.na(SNFI)),
wash = sum(!is.na(WASH)),
erl = sum(!is.na(ERL)),
cccm = sum(!is.na(CCCM)),
edu = sum(!is.na(Education)))
# Clusters operating alone
com %>%
filter(!is.na(admin4pcode) & activity != "ISIMM") %>%
group_by(admin4pcode, cluster) %>%
summarise(beneficiaries = sum(beneficiaries, na.rm = TRUE)) %>%
ungroup() %>%
pivot_wider(names_from = cluster, values_from = beneficiaries) %>%
mutate(clusters = rowSums(!is.na(.[,-1]))) %>%
filter(clusters == 1 & is.na(CCCM)) %>%
summarise(cash = sum(!is.na(Cash)),
education = sum(!is.na(Education)),
fsl = sum(!is.na(FSL)),
nut = sum(!is.na(Nutrition)),
prot = sum(!is.na(Protection)),
snfi = sum(!is.na(SNFI)),
wash = sum(!is.na(WASH)),
erl = sum(!is.na(ERL)),
cccm = sum(!is.na(CCCM)),
edu = sum(!is.na(Education))) %>%
transpose_df()
# Clusters operating alone
com %>%
filter(!is.na(admin4pcode) & activity != "ISIMM") %>%
group_by(admin4pcode, cluster) %>%
summarise(beneficiaries = sum(beneficiaries, na.rm = TRUE)) %>%
ungroup() %>%
pivot_wider(names_from = cluster, values_from = beneficiaries) %>%
mutate(clusters = rowSums(!is.na(.[,-1]))) %>%
filter(clusters == 1) %>%
summarise(cash = sum(!is.na(Cash)),
education = sum(!is.na(Education)),
fsl = sum(!is.na(FSL)),
nut = sum(!is.na(Nutrition)),
prot = sum(!is.na(Protection)),
snfi = sum(!is.na(SNFI)),
wash = sum(!is.na(WASH)),
erl = sum(!is.na(ERL)),
cccm = sum(!is.na(CCCM)),
edu = sum(!is.na(Education))) %>%
transpose_df()
com %>% glimpse()
