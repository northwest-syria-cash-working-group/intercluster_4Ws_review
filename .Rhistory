sheet = 1) %>%
clean_names() %>%
filter(ao_c == "NW") %>%
pull(admin3pcode)
locations <- read_excel("./data/Locations.xlsx") %>%
clean_names()
pop <- read_excel("./data/Population_Data_May_2022_final_01122022_with_SADD.xlsx",
sheet = 5,
skip = 2) %>%
clean_names() %>%
select(admin0name_en:longitude_x,
final_est_of_id_ps_may_2022:family_avg_size_total_pop) %>%
rename(idps = final_est_of_id_ps_may_2022,
total_pop = final_est_of_total_pop_may_2022,
avg_family_size = family_avg_size_total_pop)
consolidation_cols <- function(tbl) {
tbl %>%
select(admin1pcode, admin2pcode, admin3pcode, admin4pcode,
admin5pcode, camp_name,
activity, beneficiaries,
month, project_status, cluster,
delivery_modality,
transfer_value, total_usd)
}
fsl <- rbind(fsl %>%
mutate(month = str_to_lower(str_sub(reporting_month, start = 1L, end = 3L)),
# Not sure if I should just make it all "Ongoing" instead
project_status = "Completed",
cluster = "FSL") %>%
consolidation_cols(),
fsl_tracker %>%
mutate(month = month(distribution_date, label = TRUE),
month = str_to_lower(month),
cluster = "FSL",
admin5pcode = NA_character_) %>%
consolidation_cols())
erl %>% glimpse()
fsl_com <- rbind(fsl %>%
mutate(month = str_to_lower(str_sub(reporting_month, start = 1L, end = 3L)),
# Not sure if I should just make it all "Ongoing" instead
project_status = "Completed",
cluster = "FSL") %>%
consolidation_cols(),
fsl_tracker %>%
mutate(month = month(distribution_date, label = TRUE),
month = str_to_lower(month),
cluster = "FSL",
admin5pcode = NA_character_) %>%
consolidation_cols())
fsl_tracker <- read_csv("./data/fsl_tracker.csv")
fsl <- read_xlsb("./data/ocha_edited/FSL_January 2023_5Ws_OCHA_22032023.xlsb",
sheet = "5Ws Actuals - Jan 2023") %>%
clean_names() %>%
rename(admin1pcode = admin1_pcode_do_not_write,
admin2pcode = admin2_pcode_do_not_write,
admin3pcode = admin3_pcode_do_not_write,
admin4pcode = location_pcode_do_not_write,
admin5pcode = camp_pcode_do_not_write,
transfer_value = value,
reported_to_other_sector = has_this_data_been_reported_to_another_sector,
beneficiaries = x_of_total_beneficiaries_assisted,
families = x_of_families_assisted,
start_date = starting_date,
end_date = ending_date,
delivery_modality = delivery_modality_in_kind_service_cash_voucher,
activity = fss_activity_do_not_write,
frequency = monthly_frequency) %>%
# Crazy -- this is the first time I've seen the 1904 start date
mutate_at(vars(start_date, end_date), ~ as.Date(as.numeric(.), origin = "1904-01-01")) %>%
mutate_at(vars(camp_name_cccm_official_name,
camp_name_if_not_listed_by_the_cccm,
admin5pcode), ~ ifelse(. == "", NA_character_, .)) %>%
mutate(camp_name = ifelse(!is.na(camp_name_cccm_official_name),
camp_name_cccm_official_name,
camp_name_if_not_listed_by_the_cccm),
total_usd = frequency * transfer_value * families)
fsl_com <- rbind(fsl %>%
mutate(month = str_to_lower(str_sub(reporting_month, start = 1L, end = 3L)),
# Not sure if I should just make it all "Ongoing" instead
project_status = "Completed",
cluster = "FSL") %>%
consolidation_cols(),
fsl_tracker %>%
mutate(month = month(distribution_date, label = TRUE),
month = str_to_lower(month),
cluster = "FSL",
admin5pcode = NA_character_) %>%
consolidation_cols())
fsl_com <- rbind(fsl %>%
mutate(month = str_to_lower(str_sub(reporting_month, start = 1L, end = 3L)),
# Not sure if I should just make it all "Ongoing" instead
project_status = "Completed",
cluster = "FSL") %>%
filter(reported_to_other_sector == "No")
consolidation_cols(),
fsl_com <- rbind(fsl %>%
mutate(month = str_to_lower(str_sub(reporting_month, start = 1L, end = 3L)),
# Not sure if I should just make it all "Ongoing" instead
project_status = "Completed",
cluster = "FSL") %>%
filter(reported_to_other_sector == "No") %>%
consolidation_cols(),
fsl_tracker %>%
mutate(month = month(distribution_date, label = TRUE),
month = str_to_lower(month),
cluster = "FSL",
admin5pcode = NA_character_) %>%
consolidation_cols())
fsl_com <- rbind(fsl %>%
mutate(month = str_to_lower(str_sub(reporting_month, start = 1L, end = 3L)),
# Not sure if I should just make it all "Ongoing" instead
project_status = "Completed",
cluster = "FSL") %>%
filter(reported_to_other_sector == "No") %>%
consolidation_cols(),
fsl_tracker %>%
mutate(month = month(distribution_date, label = TRUE),
month = str_to_lower(month),
cluster = "FSL",
admin5pcode = NA_character_) %>%
consolidation_cols())
fsl_com %>% count(activities)
fsl_com %>% count(activity)
admin4 <- rbind(
wash %>%
mutate(month = str_to_lower(month)) %>%
filter(project_status == "Completed") %>%
group_by(month,
health_facility_name,
school_name,
collective_shelter_name,
admin5pcode,
admin4pcode) %>%
slice(which.max(so2)) %>%
group_by(admin4pcode, month) %>%
summarise(beneficiaries = sum(so2, na.rm = TRUE)) %>%
ungroup() %>%
mutate(cluster = "WASH"),
cash %>%
group_by(month = month(distribution_date, label = TRUE)) %>%
filter(!is.na(month)) %>%
mutate(month = str_to_lower(month)) %>%
filter(project_status == "Completed" & previously_assisted == "No") %>%
mutate(month = ifelse(month == "nov", "apr", month)) %>%
group_by(admin4pcode, month) %>%
summarise(beneficiaries = sum(beneficiaries, na.rm = TRUE)) %>%
ungroup() %>%
mutate(cluster = "Cash"),
cccm %>%
filter(activity == "CCCM") %>%
pivot_longer(cols = (jan:dec), names_to = "month", values_to = "beneficiaries") %>%
group_by(admin4pcode, month) %>%
slice(which.max(beneficiaries)) %>%
ungroup() %>%
select(admin4pcode, beneficiaries, month) %>%
mutate(cluster = "CCCM"),
erl %>%
mutate(month = str_sub(implementing_month, start = 5L, end = 7L)) %>%
filter(report_this_to_any_other_sector == "No" & previously_assisted == "No") %>%
group_by(admin4pcode, month) %>%
summarise(beneficiaries = sum(beneficiaries, na.rm = TRUE)) %>%
ungroup() %>%
mutate(cluster = "ERL"),
fsl_com %>%
filter(activity == "Food Baskets") %>%
group_by(admin4pcode, month) %>%
slice(which.max(beneficiaries)) %>%
ungroup() %>%
select(admin4pcode, beneficiaries, month) %>%
mutate(cluster = "Food"),
fsl_com %>%
filter(activity %in% c("Agricultural inputs",
"Animal treatment/vaccination",
"Income-generating activities (IGAs)",
"Infrastructure rehabilitation",
"Livestock asset restoration")) %>%
group_by(admin4pcode, month) %>%
slice(which.max(beneficiaries)) %>%
ungroup() %>%
select(admin4pcode, beneficiaries, month) %>%
mutate(cluster = "Livelihoods"),
nut %>%
mutate(month = str_to_lower(str_sub(implementing_month, start = 1L, end = 3L))) %>%
group_by(admin4pcode, month) %>%
slice(which.max(beneficiaries)) %>%
ungroup() %>%
select(admin4pcode, beneficiaries, month) %>%
mutate(cluster = "Nutrition"),
edu %>%
mutate(month = str_to_lower(str_sub(reporting_month, start = 4L, end = 6L))) %>%
group_by(admin4pcode) %>%
slice(which.max(beneficiaries, month)) %>%
ungroup() %>%
select(admin4pcode, beneficiaries, month) %>%
mutate(cluster = "Education"),
prot %>%
mutate(month = str_to_lower(str_sub(month, start = 6L, end = 8L))) %>%
filter(ao_r == "Child Protection" &
analysis_unit == "# people" &
hrp_indicator %out% c("1.3.1", "None") &
!is.na(hrp_indicator)) %>%
group_by(admin4pcode, month) %>%
summarise(beneficiaries = sum(total_reached, na.rm = TRUE)) %>%
ungroup() %>%
mutate(cluster = "Child Protection"),
prot %>%
mutate(month = str_to_lower(str_sub(month, start = 6L, end = 8L))) %>%
filter(code_activity == "GBV100" &
!is.na(hrp_indicator) &
hrp_indicator %out% c("None") &
analysis_unit == "# people") %>%
group_by(admin4pcode, month) %>%
summarise(beneficiaries = sum(total_reached, na.rm = TRUE)) %>%
ungroup() %>%
mutate(cluster = "GBV"),
prot %>%
mutate(month = str_to_lower(str_sub(month, start = 6L, end = 8L))) %>%
filter(ao_r == "Humanitarian Mine Action" &
analysis_unit == "# people") %>%
group_by(admin4pcode, month) %>%
summarise(beneficiaries = sum(total_reached, na.rm = TRUE)) %>%
ungroup() %>%
mutate(cluster = "Mine Action"),
prot %>%
mutate(month = str_to_lower(str_sub(month, start = 6L, end = 8L))) %>%
filter(ao_r == "Protection" &
analysis_unit == "# people") %>%
group_by(admin4pcode, month) %>%
summarise(beneficiaries = sum(total_reached, na.rm = TRUE)) %>%
ungroup() %>%
mutate(cluster = "General Protection"),
snfi %>%
filter(sub_cluster == "nfi" & activity == "1.1.1.1: Provision of core NFIs" &
new_beneficiaries == "Yes") %>%
mutate(month = str_to_lower(str_sub(reporting_month, start = 1L, end = 3L))) %>%
group_by(admin4pcode, month) %>%
summarise(beneficiaries = sum(beneficiaries, na.rm = TRUE)) %>%
mutate(cluster = "NFI"),
snfi %>%
filter(sub_cluster == "shelter" & new_beneficiaries == "Yes") %>%
mutate(month = str_to_lower(str_sub(reporting_month, start = 1L, end = 3L))) %>%
group_by(admin4pcode, month) %>%
summarise(beneficiaries = sum(beneficiaries, na.rm = TRUE),
.groups = "drop") %>%
mutate(cluster = "Shelter")
)
admin4 <- rbind(
wash %>%
mutate(month = str_to_lower(month)) %>%
filter(project_status == "Completed") %>%
group_by(month,
health_facility_name,
school_name,
collective_shelter_name,
admin5pcode,
admin4pcode) %>%
slice(which.max(so2)) %>%
group_by(admin4pcode, month) %>%
summarise(beneficiaries = sum(so2, na.rm = TRUE)) %>%
ungroup() %>%
mutate(cluster = "WASH"),
cash %>%
group_by(month = month(distribution_date, label = TRUE)) %>%
filter(!is.na(month)) %>%
mutate(month = str_to_lower(month)) %>%
filter(project_status == "Completed" & previously_assisted == "No") %>%
mutate(month = ifelse(month == "nov", "apr", month)) %>%
group_by(admin4pcode, month) %>%
summarise(beneficiaries = sum(beneficiaries, na.rm = TRUE)) %>%
ungroup() %>%
mutate(cluster = "Cash"),
cccm %>%
filter(activity == "CCCM") %>%
pivot_longer(cols = (jan:dec), names_to = "month", values_to = "beneficiaries") %>%
group_by(admin4pcode, month) %>%
slice(which.max(beneficiaries)) %>%
ungroup() %>%
select(admin4pcode, beneficiaries, month) %>%
mutate(cluster = "CCCM"),
erl %>%
mutate(month = str_sub(implementing_month, start = 5L, end = 7L)) %>%
filter(report_this_to_any_other_sector == "No" & previously_assisted == "No") %>%
group_by(admin4pcode, month) %>%
summarise(beneficiaries = sum(beneficiaries, na.rm = TRUE)) %>%
ungroup() %>%
mutate(cluster = "ERL"),
fsl_com %>%
filter(activity == "Food Baskets") %>%
group_by(admin4pcode, month) %>%
slice(which.max(beneficiaries)) %>%
ungroup() %>%
select(admin4pcode, beneficiaries, month) %>%
mutate(cluster = "Food"),
fsl_com %>%
filter(activity %in% c("Agricultural inputs",
"Animal treatment/vaccination",
"Income-generating activities (IGAs)",
"Infrastructure rehabilitation",
"Livestock asset restoration")) %>%
group_by(admin4pcode, month) %>%
slice(which.max(beneficiaries)) %>%
ungroup() %>%
select(admin4pcode, beneficiaries, month) %>%
mutate(cluster = "Livelihoods"),
nut %>%
mutate(month = str_to_lower(str_sub(implementing_month, start = 1L, end = 3L))) %>%
group_by(admin4pcode, month) %>%
slice(which.max(beneficiaries)) %>%
ungroup() %>%
select(admin4pcode, beneficiaries, month) %>%
mutate(cluster = "Nutrition"),
edu %>%
mutate(month = str_to_lower(str_sub(reporting_month, start = 4L, end = 6L))) %>%
group_by(admin4pcode, month) %>%
slice(which.max(beneficiaries)) %>%
ungroup() %>%
select(admin4pcode, beneficiaries, month) %>%
mutate(cluster = "Education"),
prot %>%
mutate(month = str_to_lower(str_sub(month, start = 6L, end = 8L))) %>%
filter(ao_r == "Child Protection" &
analysis_unit == "# people" &
hrp_indicator %out% c("1.3.1", "None") &
!is.na(hrp_indicator)) %>%
group_by(admin4pcode, month) %>%
summarise(beneficiaries = sum(total_reached, na.rm = TRUE),
.groups = "drop") %>%
mutate(cluster = "Child Protection"),
prot %>%
mutate(month = str_to_lower(str_sub(month, start = 6L, end = 8L))) %>%
filter(code_activity == "GBV100" &
!is.na(hrp_indicator) &
hrp_indicator %out% c("None") &
analysis_unit == "# people") %>%
group_by(admin4pcode, month) %>%
summarise(beneficiaries = sum(total_reached, na.rm = TRUE),
.groups = "drop") %>%
mutate(cluster = "GBV"),
prot %>%
mutate(month = str_to_lower(str_sub(month, start = 6L, end = 8L))) %>%
filter(ao_r == "Humanitarian Mine Action" &
analysis_unit == "# people") %>%
group_by(admin4pcode, month) %>%
summarise(beneficiaries = sum(total_reached, na.rm = TRUE),
.groups = "drop") %>%
mutate(cluster = "Mine Action"),
prot %>%
mutate(month = str_to_lower(str_sub(month, start = 6L, end = 8L))) %>%
filter(ao_r == "Protection" &
analysis_unit == "# people") %>%
group_by(admin4pcode, month) %>%
summarise(beneficiaries = sum(total_reached, na.rm = TRUE),
.groups = "drop") %>%
ungroup() %>%
mutate(cluster = "General Protection"),
snfi %>%
filter(sub_cluster == "nfi" & activity == "1.1.1.1: Provision of core NFIs" &
new_beneficiaries == "Yes") %>%
mutate(month = str_to_lower(str_sub(reporting_month, start = 1L, end = 3L))) %>%
group_by(admin4pcode, month) %>%
summarise(beneficiaries = sum(beneficiaries, na.rm = TRUE),
.groups = "drop") %>%
mutate(cluster = "NFI"),
snfi %>%
filter(sub_cluster == "shelter" & new_beneficiaries == "Yes") %>%
mutate(month = str_to_lower(str_sub(reporting_month, start = 1L, end = 3L))) %>%
group_by(admin4pcode, month) %>%
summarise(beneficiaries = sum(beneficiaries, na.rm = TRUE),
.groups = "drop") %>%
mutate(cluster = "Shelter")
)
admin4 %>%
write_csv("./data/admin4_cluster_months_beneficiaries.csv")
fsl_com %>% count(project_status)
edu %>% count(project_status)
edu %>% count(status)
nut %>% glimpse()
nut %>% count(status)
wash %>% glimpse()
wash %>% count(project_status)
prot %>% glimpse()
snfi %>% glimpse()
snfi %>% count(project_status)
admin4 <- rbind(
wash %>%
mutate(month = str_to_lower(month)) %>%
filter(project_status == "Completed") %>%
group_by(month,
health_facility_name,
school_name,
collective_shelter_name,
admin5pcode,
admin4pcode) %>%
slice(which.max(so2)) %>%
group_by(admin4pcode, month) %>%
summarise(beneficiaries = sum(so2, na.rm = TRUE)) %>%
ungroup() %>%
mutate(cluster = "WASH"),
cash %>%
group_by(month = month(distribution_date, label = TRUE)) %>%
filter(!is.na(month)) %>%
mutate(month = str_to_lower(month)) %>%
filter(project_status == "Completed" & previously_assisted == "No") %>%
mutate(month = ifelse(month == "nov", "apr", month)) %>%
group_by(admin4pcode, month) %>%
summarise(beneficiaries = sum(beneficiaries, na.rm = TRUE),
.groups = "drop") %>%
ungroup() %>%
mutate(cluster = "Cash"),
cccm %>%
filter(activity == "CCCM") %>%
pivot_longer(cols = (jan:dec), names_to = "month", values_to = "beneficiaries") %>%
group_by(admin4pcode, month) %>%
slice(which.max(beneficiaries)) %>%
ungroup() %>%
select(admin4pcode, beneficiaries, month) %>%
mutate(cluster = "CCCM"),
erl %>%
mutate(month = str_sub(implementing_month, start = 5L, end = 7L)) %>%
filter(report_this_to_any_other_sector == "No" & previously_assisted == "No") %>%
group_by(admin4pcode, month) %>%
summarise(beneficiaries = sum(beneficiaries, na.rm = TRUE),
.groups = "drop") %>%
ungroup() %>%
mutate(cluster = "ERL"),
fsl_com %>%
filter(activity == "Food Baskets" & project_status != "Planned") %>%
group_by(admin4pcode, month) %>%
slice(which.max(beneficiaries)) %>%
ungroup() %>%
select(admin4pcode, beneficiaries, month) %>%
mutate(cluster = "Food"),
fsl_com %>%
filter(activity %in% c("Agricultural inputs",
"Animal treatment/vaccination",
"Income-generating activities (IGAs)",
"Infrastructure rehabilitation",
"Livestock asset restoration") &
project_status != "Planned") %>%
group_by(admin4pcode, month) %>%
slice(which.max(beneficiaries)) %>%
ungroup() %>%
select(admin4pcode, beneficiaries, month) %>%
mutate(cluster = "Livelihoods"),
nut %>%
mutate(month = str_to_lower(str_sub(implementing_month, start = 1L, end = 3L))) %>%
group_by(admin4pcode, month) %>%
slice(which.max(beneficiaries)) %>%
ungroup() %>%
select(admin4pcode, beneficiaries, month) %>%
mutate(cluster = "Nutrition"),
edu %>%
mutate(month = str_to_lower(str_sub(reporting_month, start = 4L, end = 6L))) %>%
group_by(admin4pcode, month) %>%
slice(which.max(beneficiaries)) %>%
ungroup() %>%
select(admin4pcode, beneficiaries, month) %>%
mutate(cluster = "Education"),
prot %>%
mutate(month = str_to_lower(str_sub(month, start = 6L, end = 8L))) %>%
filter(ao_r == "Child Protection" &
analysis_unit == "# people" &
hrp_indicator %out% c("1.3.1", "None") &
!is.na(hrp_indicator)) %>%
group_by(admin4pcode, month) %>%
summarise(beneficiaries = sum(total_reached, na.rm = TRUE),
.groups = "drop") %>%
mutate(cluster = "Child Protection"),
prot %>%
mutate(month = str_to_lower(str_sub(month, start = 6L, end = 8L))) %>%
filter(code_activity == "GBV100" &
!is.na(hrp_indicator) &
hrp_indicator %out% c("None") &
analysis_unit == "# people") %>%
group_by(admin4pcode, month) %>%
summarise(beneficiaries = sum(total_reached, na.rm = TRUE),
.groups = "drop") %>%
mutate(cluster = "GBV"),
prot %>%
mutate(month = str_to_lower(str_sub(month, start = 6L, end = 8L))) %>%
filter(ao_r == "Humanitarian Mine Action" &
analysis_unit == "# people") %>%
group_by(admin4pcode, month) %>%
summarise(beneficiaries = sum(total_reached, na.rm = TRUE),
.groups = "drop") %>%
mutate(cluster = "Mine Action"),
prot %>%
mutate(month = str_to_lower(str_sub(month, start = 6L, end = 8L))) %>%
filter(ao_r == "Protection" &
analysis_unit == "# people") %>%
group_by(admin4pcode, month) %>%
summarise(beneficiaries = sum(total_reached, na.rm = TRUE),
.groups = "drop") %>%
mutate(cluster = "General Protection"),
snfi %>%
filter(sub_cluster == "nfi" & activity == "1.1.1.1: Provision of core NFIs" &
new_beneficiaries == "Yes") %>%
mutate(month = str_to_lower(str_sub(reporting_month, start = 1L, end = 3L))) %>%
group_by(admin4pcode, month) %>%
summarise(beneficiaries = sum(beneficiaries, na.rm = TRUE),
.groups = "drop") %>%
mutate(cluster = "NFI"),
snfi %>%
filter(sub_cluster == "shelter" & new_beneficiaries == "Yes") %>%
mutate(month = str_to_lower(str_sub(reporting_month, start = 1L, end = 3L))) %>%
group_by(admin4pcode, month) %>%
summarise(beneficiaries = sum(beneficiaries, na.rm = TRUE),
.groups = "drop") %>%
mutate(cluster = "Shelter")
)
admin4 %>%
write_csv("./data/admin4_cluster_months_beneficiaries.csv")
