colmatrix <- ifelse(sum_table[, -1] > 0, "#cceecc", "red")
sum_table %>%
flextable() %>%
theme_zebra() %>%
bg(j = 2:7, bg=colmatrix)
sum_table %>%
arrange(cluster) %>%
flextable() %>%
theme_zebra() %>%
bg(j = 2:7, bg=colmatrix)
sum_table %>%
arrange(cluster) %>%
rename(`Cluster/WG` = cluster) %>%
flextable() %>%
theme_zebra() %>%
bg(j = 2:7, bg=colmatrix)
sum_table %>%
arrange(cluster) %>%
rename(`Cluster/WG` = cluster) %>%
flextable() %>%
theme_zebra() %>%
bg(j = 2:7, bg=colmatrix) %>%
set_table_properties(layout = "autofit", width = .99) %>%
set_caption("Compliance with cash reporting standards") %>%
sum_table %>%
arrange(cluster) %>%
rename(`Cluster/WG` = cluster) %>%
flextable() %>%
theme_zebra() %>%
bg(j = 2:7, bg=colmatrix) %>%
set_table_properties(layout = "autofit", width = .99) %>%
set_caption("Compliance with cash reporting standards")
sum_table %>%
arrange(cluster) %>%
rename(`Cluster/WG` = cluster) %>%
flextable() %>%
theme_zebra() %>%
bg(j = 2:7, bg=colmatrix) %>%
set_table_properties(layout = "autofit", width = .99) %>%
set_caption("Compliance with cash reporting standards")
sum_table %>%
arrange(cluster) %>%
rename(`Cluster/WG` = cluster) %>%
flextable() %>%
theme_zebra() %>%
bg(j = 2:7, bg=colmatrix) %>%
set_table_properties(layout = "autofit", width = .99) %>%
set_caption("Compliance with cash reporting standards") %>%
footnote(i = 1, j = 1, part = "header",
as_paragraph("Except Cash, templates reviewed were from 2022"))
sum_table %>%
arrange(cluster) %>%
rename(`Cluster/WG` = cluster) %>%
flextable() %>%
theme_zebra() %>%
bg(j = 2:7, bg=colmatrix) %>%
set_table_properties(layout = "autofit", width = .99) %>%
set_caption("Review of 4W templates -- compliance with cash reporting standards") %>%
footnote(i = 1, j = 1, part = "header",
as_paragraph("Except Cash, templates reviewed were from 2022"))
erl <- read_excel("./data/202207_ERL_Jul_ERL_4Ws_NWS - WoS - V03.xlsx",
sheet = "4Ws") %>%
clean_names() %>%
rename(admin1pcode = admin1_pcode,
admin2pcode = admin2_pcode,
admin3pcode = admin3_pcode,
admin4pcode = admin4_pcode
)
tbl %>%
select(sector, hub, response_modality,
reporting_organisation = implementing_partner_name_or_code,
implementing_partner = final_implementing_partner_name_or_code,
governorate = governorate_mohafaza,
district = district_mantika,
sub_district = sub_district_nahya,
location,
location_type,
specific_location_name,
reporting_month,
reporting_year_yyyy,
status,
activity,
delivery_modality,
cash_conditionality,
transfer_value = cash_transfer_voucher_value_per_household_usd,
cash_delivery_mechanism,
beneficiaries = total_number_individuals_reached,
families = total_number_of_families_h_hs_reached,
admin1pcode = admin1_pcode,
admin2pcode = admin2_pcode,
admin3pcode = admin3_pcode,
admin4pcode = location_pcode)
shelter_select <- function(tbl){
tbl %>%
select(sector, hub, response_modality,
reporting_organisation = implementing_partner_name_or_code,
implementing_partner = final_implementing_partner_name_or_code,
governorate = governorate_mohafaza,
district = district_mantika,
sub_district = sub_district_nahya,
location,
location_type,
specific_location_name,
reporting_month,
reporting_year_yyyy,
status,
activity,
delivery_modality,
cash_conditionality,
transfer_value = cash_transfer_voucher_value_per_household_usd,
cash_delivery_mechanism,
beneficiaries = total_number_individuals_reached,
families = total_number_of_families_h_hs_reached,
admin1pcode = admin1_pcode,
admin2pcode = admin2_pcode,
admin3pcode = admin3_pcode,
admin4pcode = location_pcode)
}
snfi <- read_excel("./data/202207_SNFI_WoS_SNFI_4Ws_July_TurkeyHub.xlsx",
sheet = "Shelter 4Ws") %>%
clean_names() %>%
filter(!is.na(sector)) %>%
shelter_select() %>%
rbind(read_excel("./data/202207_SNFI_WoS_SNFI_4Ws_July_TurkeyHub.xlsx",
sheet = "NFI 4Ws") %>%
clean_names() %>%
filter(!is.na(sector)) %>%
shelter_select())
colmatrix <- ifelse(sum_table[, -1] == TRUE, "#cceecc", "red")
sum_table %>%
arrange(cluster) %>%
rename(`Cluster/WG` = cluster) %>%
flextable() %>%
theme_zebra() %>%
bg(j = 2:7, bg=colmatrix) %>%
set_table_properties(layout = "autofit", width = .99) %>%
set_caption("Review of 4W templates -- compliance with cash reporting standards") %>%
footnote(i = 1, j = 1, part = "header",
as_paragraph("Except Cash, templates reviewed were from 2022"))
sum_table <- tribble(
~cluster, ~admin4, ~modality, ~delivery_mechanism, ~conditionality, ~transfer_value, ~frequency,
"Cash", TRUE, TRUE, TRUE, TRUE, TRUE, TRUE,
"Education", TRUE, FALSE, FALSE, FALSE, FALSE, FALSE,
"ERL", TRUE, TRUE, TRUE, TRUE, TRUE, TRUE,
"FSL", TRUE, TRUE, TRUE, TRUE, TRUE, TRUE,
"Health", TRUE, FALSE, FALSE, FALSE, FALSE, FALSE,
"Nutrition", TRUE, FALSE, TRUE, TRUE, TRUE, TRUE,
"Protection", TRUE, TRUE, FALSE, FALSE, FALSE, FALSE,
"SNFI", TRUE, TRUE, TRUE, TRUE, TRUE, FALSE,
"WASH", TRUE, FALSE, FALSE, FALSE, TRUE, FALSE
)
colmatrix <- ifelse(sum_table[, -1] == TRUE, "#cceecc", "red")
sum_table %>%
arrange(cluster) %>%
rename(`Cluster/WG` = cluster) %>%
flextable() %>%
theme_zebra() %>%
bg(j = 2:7, bg=colmatrix) %>%
set_table_properties(layout = "autofit", width = .99) %>%
set_caption("Review of 4W templates -- compliance with cash reporting standards") %>%
footnote(i = 1, j = 1, part = "header",
as_paragraph("Except Cash, templates reviewed were from 2022"))
sum_table <- tribble(
~cluster, ~admin4, ~modality, ~delivery_mechanism, ~conditionality, ~transfer_value, ~frequency,
"Cash", TRUE, TRUE, TRUE, TRUE, TRUE, TRUE,
"CCCM", TRUE, FALSE, FALSE, FALSE, FALSE, FALSE,
"Education", TRUE, FALSE, FALSE, FALSE, FALSE, FALSE,
"ERL", TRUE, TRUE, TRUE, TRUE, TRUE, TRUE,
"FSL", TRUE, TRUE, TRUE, TRUE, TRUE, TRUE,
"Health", TRUE, FALSE, FALSE, FALSE, FALSE, FALSE,
"Nutrition", TRUE, FALSE, TRUE, TRUE, TRUE, TRUE,
"Protection", TRUE, TRUE, FALSE, FALSE, FALSE, FALSE,
"SNFI", TRUE, TRUE, TRUE, TRUE, TRUE, FALSE,
"WASH", TRUE, FALSE, FALSE, FALSE, TRUE, FALSE
)
colmatrix <- ifelse(sum_table[, -1] == TRUE, "#cceecc", "red")
sum_table %>%
rename(`Cluster/WG` = cluster) %>%
flextable() %>%
theme_zebra() %>%
bg(j = 2:7, bg=colmatrix) %>%
set_table_properties(layout = "autofit", width = .99) %>%
set_caption("Review of 4W templates -- compliance with cash reporting standards") %>%
footnote(i = 1, j = 1, part = "header",
as_paragraph("Except Cash, templates reviewed were from 2022"))
snfi <- read_excel("./data/202207_SNFI_WoS_SNFI_4Ws_July_TurkeyHub.xlsx",
sheet = "Shelter 4Ws") %>%
clean_names() %>%
filter(!is.na(sector)) %>%
shelter_select() %>%
rbind(read_excel("./data/202207_SNFI_WoS_SNFI_4Ws_July_TurkeyHub.xlsx",
sheet = "NFI 4Ws") %>%
clean_names() %>%
filter(!is.na(sector)) %>%
shelter_select())
glimpse(snfi)
snfi %>%
group_by(delivery_modality, cash_delivery_mechanism) %>%
summarise(beneficiaries = sum(beneficiaries))
snfi %>%
group_by(delivery_modality, cash_delivery_mechanism) %>%
summarise(beneficiaries = sum(beneficiaries, na.rm = TRUE))
snfi %>%
filter(delivery_modality != "END_OF_FORMULA") %>%
group_by(delivery_modality, cash_delivery_mechanism) %>%
summarise(beneficiaries = sum(beneficiaries, na.rm = TRUE))
knitr::opts_chunk$set(echo = FALSE, fig.width=9, message = FALSE, warning=FALSE)
library(tidyverse)
library(readxl)
library(lubridate)
library(stringi)
library(pander)
library(janitor)
library(scales)
library(magrittr)
library(viridis)
library(patchwork)
library(DT)
library(sf)
library(plotly)
library(flextable)
library(ggrepel)
library(magrittr)
library(readxlsb)
theme_set(theme_light())
# disabling scientific notation
options(scipen = 100)
# pander tables all in one row
panderOptions('table.split.table', Inf)
# pander thousands separator
panderOptions("big.mark", ",")
# replace
opts <- options(knitr.kable.NA = "")
`%out%` <- Negate(`%in%`)
# function for transposing df
transpose_df <- function(df) {
t_df <- data.table::transpose(df)
colnames(t_df) <- rownames(df)
rownames(t_df) <- colnames(df)
t_df <- t_df %>%
tibble::rownames_to_column(.data = .) %>%
tibble::as_tibble(.)
return(t_df)
}
# function beneficiary summaries
sum_ben <- function(df, column_var){
column_var <- enquo(column_var)
df %>%
group_by(!!column_var) %>% # must add bang-bang
summarise(beneficiaries = sum(new_beneficiaries, na.rm = TRUE)) %>%
arrange(desc(beneficiaries))
}
# function beneficiary summaries, 2 grouped variables
sum_ben2 <- function(df, column_var1, column_var2){
column_var1 <- enquo(column_var1)
column_var2 <- enquo(column_var2)
df %>%
group_by(!!column_var1, !!column_var2) %>% # must add bang-bang
summarise(beneficiaries = sum(new_beneficiaries, na.rm = TRUE), .groups = "drop")
}
# scaling functions
range01 <- function(x){(x-min(x))/(max(x)-min(x))}
range_wna <- function(x){(x-min(x, na.rm = TRUE))/(max(x, na.rm = TRUE)-min(x, na.rm = TRUE))}
#mode function
mode <- function(x) {
ux <- unique(x)
ux[which.max(tabulate(match(x, ux)))]
}
health <- read_excel("./data/202207_HEALTH_Monthly Health Indicators Report GZT Jan-July 2022.xlsx",
sheet = "Jan-July") %>%
clean_names()
health %>% glimpse()
erl <- read_excel("./data/202207_ERL_Jul_ERL_4Ws_NWS - WoS - V03.xlsx",
sheet = "4Ws") %>%
clean_names() %>%
rename(admin1pcode = admin1_pcode,
admin2pcode = admin2_pcode,
admin3pcode = admin3_pcode,
admin4pcode = admin4_pcode
)
erl %>% glimpse()
fsl <- read_xlsb("./data/202207_FSL_July 2022_5Ws_OCHA_08092022.xlsb",
sheet = "5Ws Actuals - Jul 2022") %>%
clean_names()
fsl %>% glimpse()
edu_names <- read_excel("./data/202207_EDU_Gaziantep 4Ws OCHA July 22.xlsx",
sheet = "4Ws Raw_Data Jan-May 2022") %>%
head(1) %>%
transpose_df() %>%
select(rowname) %>%
mutate(rowname = gsub("\\p{Arabic}", "", rowname, perl = TRUE),
rowname = str_trim(str_replace_all(rowname, "\r\n", ""))) %>%
pull(rowname)
edu <- read_excel("./data/202207_EDU_Gaziantep 4Ws OCHA July 22.xlsx",
sheet = "4Ws Raw_Data Jan-May 2022") %>%
setNames(edu_names) %>%
clean_names() %>%
select(-c(66:72))
edu %>% glimpse()
nut_names <- read_excel("./data/202207_NC-Full Database - NW-23082022.xlsx",
sheet = "4Ws") %>%
head(1) %>%
transpose_df() %>%
select(rowname) %>%
mutate(rowname = gsub("\\p{Arabic}", "", rowname, perl = TRUE),
rowname = str_trim(str_replace_all(rowname, "\r\n|/|\\\\", ""))) %>%
pull(rowname)
nut <- read_excel("./data/202207_NC-Full Database - NW-23082022.xlsx",
sheet = "4Ws") %>%
setNames(nut_names) %>%
clean_names() %>%
rename(admin1pcode = gov_pcode,
admin2pcode = dis_pcode,
admin3pcode = sub_dis_pcode,
admin4pcode = com_pcode)
glimpse(nut)
prot_names <- read_excel("./data/202207_PRO_EXTERNAL_TXB_Complie_4Ws_2022_r7_v1_220823.xlsx",
sheet = "a.4Ws - Data entry sheet",
skip = 1) %>%
head(1) %>%
transpose_df() %>%
select(rowname) %>%
mutate(rowname = gsub("\\p{Arabic}", "", rowname, perl = TRUE),
rowname = str_trim(str_replace_all(rowname, "\r\n|/|\\\\|\\*", ""))) %>%
pull(rowname)
prot <- read_excel("./data/202207_PRO_EXTERNAL_TXB_Complie_4Ws_2022_r7_v1_220823.xlsx",
sheet = "a.4Ws - Data entry sheet",
skip = 1) %>%
setNames(prot_names) %>%
clean_names() %>%
rename(delivery_modality = delivery_modaity)
glimpse(prot)
prot %>% glimpse()
prot %>% glimpse()
prot <- read_excel("./data/202207_PRO_EXTERNAL_TXB_Complie_4Ws_2022_r7_v1_220823.xlsx",
sheet = "a.4Ws - Data entry sheet",
skip = 1) %>%
setNames(prot_names) %>%
clean_names() %>%
rename(delivery_modality = delivery_modaity,
admin1pcode = code_governorate,
admin2pcode = code_district,
admin3pcode = code_sub_district,
admin4pcode = code_commune_village_town)
edu %>% glimpse()
fsl <- read_xlsb("./data/202207_FSL_July 2022_5Ws_OCHA_08092022.xlsb",
sheet = "5Ws Actuals - Jul 2022") %>%
clean_names()
fsl %>% glimpse()
health %>% glimpse()
prot_names <- read_excel("./data/202207_PRO_EXTERNAL_TXB_Complie_4Ws_2022_r7_v1_220823.xlsx",
sheet = "a.4Ws - Data entry sheet",
skip = 1) %>%
head(1) %>%
transpose_df() %>%
select(rowname) %>%
mutate(rowname = gsub("\\p{Arabic}", "", rowname, perl = TRUE),
rowname = str_trim(str_replace_all(rowname, "\r\n|/|\\\\|\\*", "")),
rowname = str_sub(rowname, start = 1L, end = 25L)) %>%
pull(rowname)
prot <- read_excel("./data/202207_PRO_EXTERNAL_TXB_Complie_4Ws_2022_r7_v1_220823.xlsx",
sheet = "a.4Ws - Data entry sheet",
skip = 1) %>%
setNames(prot_names) %>%
clean_names() %>%
rename(delivery_modality = delivery_modaity,
admin1pcode = code_governorate,
admin2pcode = code_district,
admin3pcode = code_sub_district,
admin4pcode = code_commune_village_town)
glimpse(prot)
knitr::opts_chunk$set(echo = FALSE, fig.width=9, message = FALSE, warning=FALSE)
library(tidyverse)
library(readxl)
library(lubridate)
library(stringi)
library(pander)
library(janitor)
library(scales)
library(magrittr)
library(viridis)
library(patchwork)
library(DT)
library(sf)
library(plotly)
library(flextable)
library(ggrepel)
library(magrittr)
library(readxlsb)
theme_set(theme_light())
# disabling scientific notation
options(scipen = 100)
# pander tables all in one row
panderOptions('table.split.table', Inf)
# pander thousands separator
panderOptions("big.mark", ",")
# replace
opts <- options(knitr.kable.NA = "")
`%out%` <- Negate(`%in%`)
# function for transposing df
transpose_df <- function(df) {
t_df <- data.table::transpose(df)
colnames(t_df) <- rownames(df)
rownames(t_df) <- colnames(df)
t_df <- t_df %>%
tibble::rownames_to_column(.data = .) %>%
tibble::as_tibble(.)
return(t_df)
}
# function beneficiary summaries
sum_ben <- function(df, column_var){
column_var <- enquo(column_var)
df %>%
group_by(!!column_var) %>% # must add bang-bang
summarise(beneficiaries = sum(new_beneficiaries, na.rm = TRUE)) %>%
arrange(desc(beneficiaries))
}
# function beneficiary summaries, 2 grouped variables
sum_ben2 <- function(df, column_var1, column_var2){
column_var1 <- enquo(column_var1)
column_var2 <- enquo(column_var2)
df %>%
group_by(!!column_var1, !!column_var2) %>% # must add bang-bang
summarise(beneficiaries = sum(new_beneficiaries, na.rm = TRUE), .groups = "drop")
}
# scaling functions
range01 <- function(x){(x-min(x))/(max(x)-min(x))}
range_wna <- function(x){(x-min(x, na.rm = TRUE))/(max(x, na.rm = TRUE)-min(x, na.rm = TRUE))}
#mode function
mode <- function(x) {
ux <- unique(x)
ux[which.max(tabulate(match(x, ux)))]
}
edu <- read_excel("./data/202207_EDU_Gaziantep 4Ws OCHA July 22.xlsx",
sheet = "4Ws Raw_Data Jan-May 2022") %>%
setNames(edu_names) %>%
clean_names() %>%
select(-c(66:72)) %>%
rename(admin1pcode = governorate_pcode,
admin2pcode = district_pcode,
admin3pcode = sub_district_pcode,
admin4pcode = community_pcode)
edu_names <- read_excel("./data/202207_EDU_Gaziantep 4Ws OCHA July 22.xlsx",
sheet = "4Ws Raw_Data Jan-May 2022") %>%
head(1) %>%
transpose_df() %>%
select(rowname) %>%
mutate(rowname = gsub("\\p{Arabic}", "", rowname, perl = TRUE),
rowname = str_trim(str_replace_all(rowname, "\r\n", ""))) %>%
pull(rowname)
edu_names <- read_excel("./data/202207_EDU_Gaziantep 4Ws OCHA July 22.xlsx",
sheet = "4Ws Raw_Data Jan-May 2022") %>%
head(1) %>%
transpose_df() %>%
select(rowname) %>%
mutate(rowname = gsub("\\p{Arabic}", "", rowname, perl = TRUE),
rowname = str_trim(str_replace_all(rowname, "\r\n", ""))) %>%
pull(rowname)
edu <- read_excel("./data/202207_EDU_Gaziantep 4Ws OCHA July 22.xlsx",
sheet = "4Ws Raw_Data Jan-May 2022") %>%
setNames(edu_names) %>%
clean_names() %>%
select(-c(66:72)) %>%
rename(admin1pcode = governorate_pcode,
admin2pcode = district_pcode,
admin3pcode = sub_district_pcode,
admin4pcode = community_pcode)
edu %>% glimpse()
edu %>% count(activity)
health <- read_excel("./data/202207_HEALTH_Monthly Health Indicators Report GZT Jan-July 2022.xlsx",
sheet = "Jan-July") %>%
clean_names()
health %>% glimpse()
prot_names <- read_excel("./data/202207_PRO_EXTERNAL_TXB_Complie_4Ws_2022_r7_v1_220823.xlsx",
sheet = "a.4Ws - Data entry sheet",
skip = 1) %>%
head(1) %>%
transpose_df() %>%
select(rowname) %>%
mutate(rowname = gsub("\\p{Arabic}", "", rowname, perl = TRUE),
rowname = str_trim(str_replace_all(rowname, "\r\n|/|\\\\|\\*", ""))) %>%
pull(rowname)
prot_names <- read_excel("./data/202207_PRO_EXTERNAL_TXB_Complie_4Ws_2022_r7_v1_220823.xlsx",
sheet = "a.4Ws - Data entry sheet",
skip = 1) %>%
head(1) %>%
transpose_df() %>%
select(rowname) %>%
mutate(rowname = gsub("\\p{Arabic}", "", rowname, perl = TRUE),
rowname = str_trim(str_replace_all(rowname, "\r\n|/|\\\\|\\*", ""))) %>%
pull(rowname)
prot <- read_excel("./data/202207_PRO_EXTERNAL_TXB_Complie_4Ws_2022_r7_v1_220823.xlsx",
sheet = "a.4Ws - Data entry sheet",
skip = 1) %>%
setNames(prot_names) %>%
clean_names() %>%
rename(delivery_modality = delivery_modaity,
admin1pcode = code_governorate,
admin2pcode = code_district,
admin3pcode = code_sub_district,
admin4pcode = code_commune_village_town)
prot %>% glimpse()
prot %>% count(activity)
prot %>%
filter(activity == "Cash assistance - GP7")
prot %>%
filter(activity == "Cash assistance - GP7") %>%
summarise(beneficiaries = sum(total_achieved_as_per_the_unit_in_the_previous_field, na.rm = TRUE))
prot %>% count(delivery_modality)
prot %>%
filter(activity == "Cash assistance - GP7") %>%
summarise(beneficiaries = sum(total_achieved_as_per_the_unit_in_the_previous_field, na.rm = TRUE))
