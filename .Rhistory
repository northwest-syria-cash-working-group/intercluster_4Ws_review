shelter_select <- function(tbl){
tbl %>%
select(sector, hub, response_modality,
# reporting_organisation = implementing_partner_name_or_code,
implementing_partner = final_implementing_partner_name_or_code,
governorate = governorate_mohafaza,
district = district_mantika,
sub_district = sub_district_nahya,
location,
location_type,
community = specific_location_name,
reporting_month,
start_date = activity_start_date_dd_mm_yyyy,
end_date = activity_end_date_dd_mm_yyyy,
project_status = status,
activity,
delivery_modality,
cash_conditionality,
transfer_value = cash_transfer_voucher_value_per_household_usd,
cash_delivery_mechanism,
beneficiaries = total_number_individuals_reached,
families = total_number_of_families_h_hs_reached,
admin1pcode = admin1_pcode,
admin2pcode = admin2_pcode,
admin3pcode = admin3_pcode,
admin4pcode = location_pcode,
new_beneficiaries = first_round_of_response_type_starting_2023)
}
snfi <- read_excel("./data/ocha_unedited/2023_WoS_SNFI_XBHub_4Ws_Jan&Feb2023.xlsx",
sheet = "Shelter 4Ws") %>%
clean_names() %>%
filter(!is.na(sector)) %>%
shelter_select() %>%
mutate(cluster = "shelter") %>%
filter(activity != "END_OF_FORMULA") %>%
rbind(read_excel("./data/ocha_unedited/2023_WoS_SNFI_XBHub_4Ws_Jan&Feb2023.xlsx",
sheet = "NFI 4Ws") %>%
clean_names() %>%
filter(!is.na(sector)) %>%
shelter_select() %>%
mutate(cluster = "nfi") %>%
filter(activity != "END_OF_FORMULA"))
health_names <- read_excel("./data/ocha_unedited/Monthly Health Cluster Indicators Report GZT Jan-Feb 2023.xlsx",
sheet = 1) %>%
clean_names() %>%
transpose_df() %>%
select(rowname) %>%
mutate(rowname = str_replace_all(rowname,
"number_of_|for_|supported_|between_levels_of_care_|received_|inside_syria_cross_line_and_cross_border_|inside_syria__cross_line_and_cross_border|attended_by_a_", ""),
rowname = str_replace_all(rowname, "consultations", "cons"),
rowname = str_replace_all(rowname, "rehabilitation_sessions", "rehab_sess")) %>%
mutate(rowname = ifelse(nchar(rowname) > 75,
str_sub(rowname, start = 1L, end = 75L),
rowname)) %>%
pull(rowname)
health <- read_excel("./data/ocha_unedited/Monthly Health Cluster Indicators Report GZT Jan-Feb 2023.xlsx",
sheet = 1) %>%
setNames(health_names) %>%
pivot_longer(cols = (medical_procedures:
x3_1_6_community_health_workers_trained_re_trained_on_different_health_topi),
names_to = "activity",
values_to = "beneficiaries") %>%
rename(governorate = location_gov,
admin1pcode = code_governorate,
district = location_district,
admin2pcode = code_district,
sub_district = location_sub_district,
admin3pcode = code_sub_district,
community = location_community,
admin4pcode = code_community)
erl <- read_excel("./data/ocha_unedited/2023-02Feb_ERL_4Ws_NWS - WoS - V03 -WoS Validated.xlsx",
sheet = "4Ws") %>%
clean_names() %>%
rename(admin1pcode = admin1_pcode,
admin2pcode = admin2_pcode,
admin3pcode = admin3_pcode,
admin4pcode = admin4_pcode,
partner_code = implementing_partner,
beneficiaries = direct_beneficiaries,
previously_assisted = have_you_assisted_same_individual_during_previous_month,
conditionality = if_cash_cash_conditionality,
restrictions = if_cash_cash_restriction,
cash_delivery_mechanism = if_cash_cash_delivery_mechanism,
transfer_value = if_cash_cash_transfer_voucher_value_per_household_usd,
frequency = if_cash_cash_frequency)
fsl <- read_xlsb("./data/ocha_edited/FSL_January 2023_5Ws_OCHA_22032023.xlsb",
sheet = "5Ws Actuals - Jan 2023") %>%
clean_names() %>%
rename(admin1pcode = admin1_pcode_do_not_write,
admin2pcode = admin2_pcode_do_not_write,
admin3pcode = admin3_pcode_do_not_write,
admin4pcode = location_pcode_do_not_write,
admin5pcode = camp_pcode_do_not_write,
transfer_value = value,
reported_to_other_sector = has_this_data_been_reported_to_another_sector,
beneficiaries = x_of_total_beneficiaries_assisted,
families = x_of_families_assisted,
start_date = starting_date,
end_date = ending_date,
delivery_modality = delivery_modality_in_kind_service_cash_voucher,
activity = fss_activity_do_not_write) %>%
# Crazy -- this is the first time I've seen the 1904 start date
mutate_at(vars(start_date, end_date), ~ as.Date(as.numeric(.), origin = "1904-01-01"))
edu_names <- read_excel("./data/ocha_unedited/Gaziantep 4Ws OCHA 2023 EDU.xlsx",
sheet = 5) %>%
head(1) %>%
transpose_df() %>%
select(rowname) %>%
mutate(rowname = gsub("\\p{Arabic}", "", rowname, perl = TRUE),
rowname = str_trim(str_replace_all(rowname, "\r\n", ""))) %>%
pull(rowname)
edu <- read_excel("./data/ocha_unedited/Gaziantep 4Ws OCHA 2023 EDU.xlsx",
sheet = 5) %>%
setNames(edu_names) %>%
clean_names() %>%
rename(admin1pcode = governorate_pcode,
admin2pcode = district_pcode,
admin3pcode = sub_district_pcode,
admin4pcode = community_pcode,
beneficiaries = total_new_individuals,
ben_frequencies = total_repeated_beneficiaries_reached,
camp_name = if_camp_please_select_the_name_of_the_camp_u_060c,
school_name = name_of_school_learning_center,
partner_code = implementing_partner_name_or_code)
nut <- read_excel("./data/ocha_unedited/NW Syria Nutrition cluster Jan + Feb 4Ws Dataset-Coded04042023.xlsx",
sheet = 1) %>%
clean_names() %>%
rename(admin1pcode = gov_pcode,
admin2pcode = dis_pcode,
admin3pcode = sub_dis_pcode,
admin4pcode = com_pcode,
partner_code = organisation,
camp_name = camp,
health_facility_name = health_facility_or_rrt) %>%
mutate(beneficiaries = male + female)
prot_names <- read_excel("./data/ocha_unedited/EXTERNAL_NWS_Complie_5Ws_2023_r1_v1_04042023.xlsx",
sheet = "Data entry sheet",
skip = 2) %>%
head(1) %>%
transpose_df() %>%
mutate(col_id = row_number()) %>%
mutate(rowname = gsub("\\p{Arabic}", "", rowname, perl = TRUE),
rowname = str_trim(str_replace_all(rowname, "\r\n|/|\\\\|\\*", ""))) %>%
mutate(rowname = case_when(col_id == 34 ~ "total_reached",
col_id == 18 ~ "unit",
col_id == 21 ~ "pwd",
col_id == 22 ~ "earthquake_response",
col_id == 16 ~ "service_delivery",
TRUE ~ rowname)) %>%
pull(rowname)
prot <- read_excel("./data/ocha_unedited/EXTERNAL_NWS_Complie_5Ws_2023_r1_v1_04042023.xlsx",
sheet = "Data entry sheet",
skip = 2) %>%
setNames(prot_names) %>%
clean_names() %>%
rename(admin1pcode = code_governorate,
admin2pcode = code_district,
admin3pcode = code_sub_district,
admin4pcode = code_commune_village_town,
delivery_modality = delivery_modaity,
beneficiary_type = type_of_beneficiaries_only_if_unit_number_people,
total_achieved_as_per_unit = total_achieved_as_per_the_unit_in_the_previous_field,
hrp_project = hrp_project_or_not_yn_u_061f)
locations <- read_excel("./data/Locations.xlsx") %>%
clean_names()
glimpse(locations)
wash <- read_excel("./data/ocha_unedited/WASH OCHA2023_feb.xlsx",
sheet = 1) %>%
clean_names() %>%
rename(admin3pcode = sd_pcode,
admin4pcode = com_p_code,
admin5pcode = camp_pcode,
beneficiaries_in_location = number_benificiaries_in_the_location2,
camp_name = camp_asm_almkhym,
school_name = schools_asm_lmdrst,
collective_shelter_name = collective_shelter_asm_mrkz_alaywa_u_02be,
health_facility_name = health_facility_name_asm_almnshat_altbyt,
water_system_name = name_of_water_system_asm_mhtt_almyah,
partner_code = ip_code,
start_date = project_start_date,
end_date = project_end_date,
quarter = month,
month = iincluding_date,
project_status = status_alhalt,
governorate = gov) %>%
mutate(partner_code = ifelse(is.na(partner_code), ngo_code, partner_code),
cluster = "wash") %>%
left_join(select(admin1pcode, admin2pcode, admin3pcode),
by = "admin3pcode")
wash <- read_excel("./data/ocha_unedited/WASH OCHA2023_feb.xlsx",
sheet = 1) %>%
clean_names() %>%
rename(admin3pcode = sd_pcode,
admin4pcode = com_p_code,
admin5pcode = camp_pcode,
beneficiaries_in_location = number_benificiaries_in_the_location2,
camp_name = camp_asm_almkhym,
school_name = schools_asm_lmdrst,
collective_shelter_name = collective_shelter_asm_mrkz_alaywa_u_02be,
health_facility_name = health_facility_name_asm_almnshat_altbyt,
water_system_name = name_of_water_system_asm_mhtt_almyah,
partner_code = ip_code,
start_date = project_start_date,
end_date = project_end_date,
quarter = month,
month = iincluding_date,
project_status = status_alhalt,
governorate = gov) %>%
mutate(partner_code = ifelse(is.na(partner_code), ngo_code, partner_code),
cluster = "wash") %>%
left_join(locations %>%
select(admin1pcode, admin2pcode, admin3pcode),
by = "admin3pcode")
prot %>% glimpse()
prot <- read_excel("./data/ocha_unedited/EXTERNAL_NWS_Complie_5Ws_2023_r1_v1_04042023.xlsx",
sheet = "Data entry sheet",
skip = 2) %>%
setNames(prot_names) %>%
clean_names() %>%
rename(admin1pcode = code_governorate,
admin2pcode = code_district,
admin3pcode = code_sub_district,
admin4pcode = code_commune_village_town,
admin5pcode = code_camps,
delivery_modality = delivery_modaity,
beneficiary_type = type_of_beneficiaries_only_if_unit_number_people,
total_achieved_as_per_unit = total_achieved_as_per_the_unit_in_the_previous_field,
hrp_project = hrp_project_or_not_yn_u_061f)
prot %>% count(month)
prot %>%
mutate(month = str_to_lower(str_sub(month, start = 6L, end = 8L))) %>%
count(month)
nut %>%
glimpse()
nut %>%
mutate(month = str_to_lower(str_sub(month, start = 1L, end = 3L)),
admin5pcode = NA_character_) %>%
select(admin1pcode, admin2pcode, admin3pcode, admin4pcode,
admin5pcode, camp_name,
activity, beneficiaries,
month)
nut %>%
mutate(month = str_to_lower(str_sub(implementing_month, start = 1L, end = 3L)),
admin5pcode = NA_character_) %>%
select(admin1pcode, admin2pcode, admin3pcode, admin4pcode,
admin5pcode, camp_name,
activity, beneficiaries,
month)
wash %>% glimpse()
wash <- read_excel("./data/ocha_unedited/WASH OCHA2023_feb.xlsx",
sheet = 1) %>%
clean_names() %>%
rename(admin3pcode = sd_pcode,
admin4pcode = com_p_code,
admin5pcode = camp_pcode,
beneficiaries_in_location = number_benificiaries_in_the_location2,
camp_name = camp_asm_almkhym,
school_name = schools_asm_lmdrst,
collective_shelter_name = collective_shelter_asm_mrkz_alaywa_u_02be,
health_facility_name = health_facility_name_asm_almnshat_altbyt,
water_system_name = name_of_water_system_asm_mhtt_almyah,
partner_code = ip_code,
start_date = project_start_date,
end_date = project_end_date,
quarter = month,
month = iincluding_date,
project_status = status_alhalt,
governorate = gov) %>%
mutate(partner_code = ifelse(is.na(partner_code), ngo_code, partner_code),
cluster = "wash") %>%
left_join(locations %>%
select(admin1pcode, admin2pcode, admin3pcode),
by = "admin3pcode") %>%
rename(construction_water_network = constuction_water_network,
fuel_consumption = fule_consumption,
construction_water_station = constuction_water_station,
cholera_wash_in_health =  cholera_was_hin_health,
reporting_month = reporting_month_shhr_altqryr)
prot %>% glimpse(
)
nut %>% glimpse()
wash %>% glimpse()
snfi %>% glimpse()
wash %>%
pivot_longer(cols = c(rehab_repair_water_station,
o_m,
construction_water_station,
network_rehab,
construction_water_network,
chlorination,
wq_testing,
fuel_consumption,
water_safety_plans,
water_trucking,
cash_assistance_water_trucking,
pvt_boreholes,
cash_assistance_private_boreholes,
tanks_pwd_ben,
hh_water_treatment,
hh_water_treatement_cash_assistance,
sew_rehab_repair,
sew_support,
sew_construction,
beneficiaries_toilets,
pw_d_beneficiaries_toilet,
beneficiaries_cash_toilets,
bath_new,
cash_bath,
des_beneficiaries,
swm_support_benf,
hp_ben,
hp_pwd_ben,
hk_ben,
cash_hk,
pwd_beneficiaries,
wash_nfi_ben,
incinerator_health_facilities,
cholera_safe_water,
chlorin_cholera,
cholera_sew,
cholera_kit,
cholera_hp_rcce_iec,
cholera_was_hin_health),
names_to = "activity", values_to = "beneficiaries") %>%
# Are these really the columns you want to select?
# I think you have to cut it down even more
select(admin1pcode, admin2pcode, admin3pcode, admin4pcode,
admin5pcode, camp_name,
activity, beneficiaries,
month, project_status, cluster)
wash %>%
pivot_longer(cols = c(rehab_repair_water_station,
o_m,
construction_water_station,
network_rehab,
construction_water_network,
chlorination,
wq_testing,
fuel_consumption,
water_safety_plans,
water_trucking,
cash_assistance_water_trucking,
pvt_boreholes,
cash_assistance_private_boreholes,
tanks_pwd_ben,
hh_water_treatment,
hh_water_treatement_cash_assistance,
sew_rehab_repair,
sew_support,
sew_construction,
beneficiaries_toilets,
pw_d_beneficiaries_toilet,
beneficiaries_cash_toilets,
bath_new,
cash_bath,
des_beneficiaries,
swm_support_benf,
hp_ben,
hp_pwd_ben,
hk_ben,
cash_hk,
pwd_beneficiaries,
wash_nfi_ben,
incinerator_health_facilities,
cholera_safe_water,
chlorin_cholera,
cholera_sew,
cholera_kit,
cholera_hp_rcce_iec,
cholera_wash_in_health),
names_to = "activity", values_to = "beneficiaries") %>%
# Are these really the columns you want to select?
# I think you have to cut it down even more
select(admin1pcode, admin2pcode, admin3pcode, admin4pcode,
admin5pcode, camp_name,
activity, beneficiaries,
month, project_status, cluster)
snfi %>% glimpse()
snfi %>%
mutate(month = str_to_lower(str_sub(reporting_month, start = 1L, end = 3L)),
admin5pcode = NA_character_) %>%
select(admin1pcode, admin2pcode, admin3pcode, admin4pcode,
admin5pcode, camp_name,
activity, beneficiaries,
month, project_status, cluster)
snfi %>%
mutate(month = str_to_lower(str_sub(reporting_month, start = 1L, end = 3L)),
admin5pcode = NA_character_,
camp_name = NA_character_) %>%
select(admin1pcode, admin2pcode, admin3pcode, admin4pcode,
admin5pcode, camp_name,
activity, beneficiaries,
month, project_status, cluster)
cccm %>% glimpse()
cccm %>%
pivot_longer(cols = (jan:dec), names_to = "month", values_to = "beneficiaries") %>%
filter(admin3pcode %in% nw_pcode3)
cccm %>% glimpse()
cccm %>%
pivot_longer(cols = (jan:dec), names_to = "month", values_to = "beneficiaries") %>%
filter(admin3pcode %in% nw_pcode3) %>%
mutate(admin5pcode = NA_character_,
camp_name = NA_character_) %>%
select(admin1pcode, admin2pcode, admin3pcode, admin4pcode,
admin5pcode, camp_name,
activity, beneficiaries,
month, project_status, cluster)
cccm %>% glimpse()
cccm %>%
pivot_longer(cols = (jan:dec), names_to = "month", values_to = "beneficiaries") %>%
filter(admin3pcode %in% nw_pcode3) %>%
mutate(admin5pcode = NA_character_,
camp_name = NA_character_,
project_status = "Completed") %>%
select(admin1pcode, admin2pcode, admin3pcode, admin4pcode,
admin5pcode, camp_name,
activity, beneficiaries,
month, project_status, cluster)
fsl %>%
glimpse()
fsl %>%
mutate_at(vars(camp_name_cccm_official_name,
camp_name_if_not_listed_by_the_cccm,
admin5pcode), ~ ifelse(. == "", NA_character_, .))
fsl %>%
mutate_at(vars(camp_name_cccm_official_name,
camp_name_if_not_listed_by_the_cccm,
admin5pcode), ~ ifelse(. == "", NA_character_, .)) %>%
glimpse()
fsl %>%
mutate_at(vars(camp_name_cccm_official_name,
camp_name_if_not_listed_by_the_cccm,
admin5pcode), ~ ifelse(. == "", NA_character_, .)) %>%
mutate(camp_name = ifelse(!is.na(camp_name_cccm_official_name),
camp_name_cccm_official_name,
camp_name_if_not_listed_by_the_cccm)) %>%
glimpse()
fsl <- read_xlsb("./data/ocha_edited/FSL_January 2023_5Ws_OCHA_22032023.xlsb",
sheet = "5Ws Actuals - Jan 2023") %>%
clean_names() %>%
rename(admin1pcode = admin1_pcode_do_not_write,
admin2pcode = admin2_pcode_do_not_write,
admin3pcode = admin3_pcode_do_not_write,
admin4pcode = location_pcode_do_not_write,
admin5pcode = camp_pcode_do_not_write,
transfer_value = value,
reported_to_other_sector = has_this_data_been_reported_to_another_sector,
beneficiaries = x_of_total_beneficiaries_assisted,
families = x_of_families_assisted,
start_date = starting_date,
end_date = ending_date,
delivery_modality = delivery_modality_in_kind_service_cash_voucher,
activity = fss_activity_do_not_write) %>%
# Crazy -- this is the first time I've seen the 1904 start date
mutate_at(vars(start_date, end_date), ~ as.Date(as.numeric(.), origin = "1904-01-01")) %>%
mutate_at(vars(camp_name_cccm_official_name,
camp_name_if_not_listed_by_the_cccm,
admin5pcode), ~ ifelse(. == "", NA_character_, .)) %>%
mutate(camp_name = ifelse(!is.na(camp_name_cccm_official_name),
camp_name_cccm_official_name,
camp_name_if_not_listed_by_the_cccm))
fsl %>%
mutate(month = str_to_lower(str_sub(reporting_month, start = 1L, end = 3L))) %>%
select(admin1pcode, admin2pcode, admin3pcode, admin4pcode,
admin5pcode, camp_name,
activity, beneficiaries,
month, project_status, cluster)
fsl %>% glimpse()
cash %>%
glimpse()
cash <- read_csv("./data/cbr_com.csv")
cash %>%
glimpse()
cash %>%
glimpse()
cash <- read_csv("./data/cbr_com.csv")
cash %>%
glimpse()
cash %>%
mutate(month = month(distribution_date)) %>%
count(month)
cash %>%
mutate(month = month(distribution_date, label = TRUE)) %>%
count(month)
cash %>%
mutate(month = month(distribution_date, label = TRUE),
month = str_to_lower(month)) %>%
count(month)
cash %>%
mutate(month = month(distribution_date, label = TRUE),
month = str_to_lower(month)) %>%
select(admin1pcode, admin2pcode, admin3pcode, admin4pcode,
admin5pcode, camp_name,
activity, beneficiaries,
month, project_status, cluster)
cash %>%
mutate(month = month(distribution_date, label = TRUE),
month = str_to_lower(month),
activity = "multipurpose cash") %>%
select(admin1pcode, admin2pcode, admin3pcode, admin4pcode,
admin5pcode, camp_name,
activity, beneficiaries,
month, project_status, cluster)
cash %>%
mutate(month = month(distribution_date, label = TRUE),
month = str_to_lower(month),
activity = "multipurpose cash",
cluster = "cash") %>%
select(admin1pcode, admin2pcode, admin3pcode, admin4pcode,
admin5pcode, camp_name,
activity, beneficiaries,
month, project_status, cluster)
